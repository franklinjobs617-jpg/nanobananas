<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Policy | NanoBananas.me</title>
    <meta name="description"
        content="Privacy policy for NanoBananas.me, explaining how we handle your data when using our nano banana AI generator.">
    <meta name="keywords" content="nano banana privacy, nano banana ai privacy policy, data protection">
    <link rel="canonical" href="https://www.nanobananas.me/privacy.html" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFD166',
                        secondary: '#073B4C',
                        accent: '#EF476F',
                        light: '#F8F9FA',
                        dark: '#111827'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
        .text-shadow {
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .gradient-text {
          @apply bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent;
        }
        .card-hover {
          @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-1;
        }
        .star-rating .star {
          @apply text-gray-300 cursor-pointer transition-colors;
        }
        .star-rating .star.active {
          @apply text-primary;
        }
      }
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0BS5F771SF"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-0BS5F771SF');
    </script>
</head>

<body class="font-inter bg-light text-dark">
    <!-- 导航栏 -->
    <header class="sticky top-0 left-0 right-0 bg-white/90 backdrop-blur-md z-50 shadow-sm transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20">
                <a href="/" class="flex items-center gap-2">
                    <div
                        class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center">
                        <span class="text-white font-bold text-xl">N</span>
                    </div>
                    <span class="text-xl md:text-2xl font-bold gradient-text">
                        NanoBananas
                    </span>
                </a>

                <nav class="hidden md:flex items-center space-x-8">
                    <a href="./nano_banana_ai_saree.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Ai Saree</a>
                    <a href="./nano-banana-collection-prompts.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Prompts</a>
                    <a href="#examples"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Examples</a>
                    <a href="./nano-banana-3d-figurines-guide.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Figures</a>
                    <a href="./pricing.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Pricing</a>
                    <a href="bandai-nano-banana.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Bandai Style</a>

                    <a href="nano-banana-model-kit.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Model kit</a>
                    <a href="nano-banana-model.html"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">3d
                        Model</a>
                    <a href="#ratings"
                        class="text-gray-600 hover:text-primary transition-colors font-medium">Ratings</a>
                    <a href="#faq" class="text-gray-600 hover:text-primary transition-colors font-medium">FAQ</a>
                </nav>
                <div class="flex items-center gap-3">
                    <!-- Sign In Button (Visible when logged out) -->
                    <button id="open-login-modal-btn"
                        class="bg-primary text-secondary font-semibold px-5 py-2 rounded-lg text-sm hover:opacity-90 transition-opacity">
                        Sign In
                    </button>
                    <div id="user-info-container" class="hidden relative">
                        <!-- This button is the trigger for the dropdown -->
                        <button id="user-menu-button" class="flex items-center gap-2 focus:outline-none rounded-full">
                            <img id="user-avatar" src="" alt="User Avatar"
                                class="w-9 h-9 rounded-full object-cover border-2 border-primary/50">
                            <span id="user-name"
                                class="hidden sm:inline text-sm font-medium text-gray-700 pointer-events-none"></span>
                        </button>

                        <!-- New Dropdown Menu Styled to Match Your Image -->
                        <div id="user-menu-dropdown"
                            class="absolute right-0 top-4 md:top-10 mt-3 w-64 origin-top-right bg-white rounded-xl shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                            role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                            <div class="p-4" role="none">
                                <!-- User Name and Email -->
                                <div class="mb-4">
                                    <p id="dropdown-user-name" class="text-sm font-semibold text-gray-800 truncate"
                                        role="none"></p>
                                    <p id="dropdown-user-email" class="text-xs text-gray-500 truncate" role="none"></p>
                                </div>

                                <!-- Credits -->
                                <div class="flex justify-between items-center text-sm text-gray-700 py-2">
                                    <div class="flex items-center">
                                        <i class="fa fa-database w-5 text-center text-orange-500 mr-2"></i>
                                        <span>Credits</span>
                                    </div>
                                    <span id="user-credits" class="font-bold text-orange-500">2</span>
                                </div>


                                <div class="border-t border-gray-100 my-2"></div>

                                <!-- Sign Out Button -->
                                <button id="logout-btn"
                                    class="w-full text-left flex items-center px-2 py-2 text-sm text-red-600 rounded-md hover:bg-red-50"
                                    role="menuitem">
                                    <i class="fa fa-sign-out w-5 text-center mr-2"></i>
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Mobile Menu Toggle -->
                    <button id="menu-toggle" class="md:hidden text-2xl text-gray-600 hover:text-primary">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <div class="container mx-auto px-4 py-3 space-y-3">
                <a href="./nano_banana_ai_saree.html"
                    class="text-gray-600 hover:text-primary transition-colors font-medium">Ai
                    Saree</a>
                <a href="./nano-banana-collection-prompts.html"
                    class="block py-2 text-gray-600 hover:text-primary transition-colors font-medium">Prompts</a>
                <a href="#examples"
                    class="block py-2 text-gray-600 hover:text-primary transition-colors font-medium">Examples</a>
                <a href="./nano-banana-3d-figurines-guide.html"
                    class="block py-2 text-gray-600 hover:text-primary transition-colors font-medium">Figures</a>
                <a href="pricing.html"
                    class="text-gray-600 hover:text-primary transition-colors font-medium">Pricing</a>
                <a href="bandai-nano-banana.html"
                    class="block py-2 text-gray-600 hover:text-primary transition-colors font-medium">Bandai Style</a>
                <a href="nano-banana-model-kit.html"
                    class="text-gray-600 hover:text-primary transition-colors font-medium">Model kit</a>
                <a href="nano-banana-model.html"
                    class="text-gray-600 hover:text-primary transition-colors font-medium">3d
                    Model</a>
                <a href="#ratings"
                    class="block py-2 text-gray-600 hover:text-primary transition-colors font-medium">Ratings</a>
                <a href="#faq" class="block py-2 text-gray-600 hover:text-primary transition-colors font-medium">FAQ</a>


            </div>
        </div>
    </header>

    <div id="image-preview-modal"
        class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="relative max-w-4xl max-h-[90vh] w-full h-full">
            <!-- Close Button -->
            <button id="close-preview-modal-btn"
                class="absolute -top-10 right-0 text-white hover:text-primary transition-colors z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <!-- Image Container -->
            <div class="w-full h-full flex items-center justify-center">
                <img id="preview-modal-image" src="" alt="Generated Image Preview"
                    class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
            </div>
        </div>
    </div>

    <!-- =============================================================== -->
    <!-- Login Modal -->
    <!-- =============================================================== -->
    <div id="login-modal" class="hidden fixed inset-0 bg-black/30 z-50 flex items-center justify-center p-4">
        <div class="bg-dark text-light p-8 rounded-2xl shadow-2xl w-full max-w-md relative" id="login-modal-content">
            <button id="close-login-modal-btn"
                class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="text-center mb-6">
                <p class="text-sm text-gray-400">Nano Banana AI</p>
                <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-center text-white">Welcome to <span
                        class="text-gray-400">Nano Banana</span></h1>
            </div>
            <div class="w-full bg-white/5 p-2 rounded-xl backdrop-blur-sm border border-white/10">
                <p
                    class="flex items-center justify-center gap-2 text-sm sm:text-base md:text-lg font-medium text-white">
                    <span class="text-lg mr-2">🎁</span> Free Usage credits daily after sign-in
                </p>
            </div>
            <button id="loginBtn"
                class="mt-4 w-full h-10 px-4 py-2.5 sm:py-3 bg-white hover:bg-gray-100 text-black text-sm sm:text-base font-medium rounded-lg transition-all duration-300 flex items-center justify-center gap-2 sm:gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
                    stroke="none" class="h-4 w-4">
                    <path
                        d="M12 2a9.96 9.96 0 0 1 6.29 2.226a1 1 0 0 1 .04 1.52l-1.51 1.362a1 1 0 0 1 -1.265 .06a6 6 0 1 0 2.103 6.836l.001 -.004h-3.66a1 1 0 0 1 -.992 -.883l-.007 -.117v-2a1 1 0 0 1 1 -1h6.945a1 1 0 0 1 .994 .89c.04 .367 .061 .737 .061 1.11c0 5.523 -4.477 10 -10 10s-10 -4.477 -10 -10s4.477 -10 10 -10z">
                    </path>
                </svg>
                Sign in with Google
            </button>
        </div>
    </div>

    <!-- 主要内容 -->
    <section class="py-16 md:py-24">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-3xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-8">Privacy Policy</h1>
                <p class="text-gray-600 mb-6">
                    Last updated: July 15, 2025
                </p>

                <p class="text-gray-700 mb-6">
                    NanoBananas.me ("we", "us", or "our") is committed to protecting your privacy. This Privacy Policy
                    explains how we collect, use, and disclose information when you use our nano banana AI generator and
                    related services (collectively, the "Service").
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">1. Information We Collect</h2>

                <h3 class="text-xl font-semibold mt-6 mb-3">1.1 Information You Provide</h3>
                <p class="text-gray-700 mb-6">
                    When using our Service, you may provide us with text prompts for generating nano banana figures and
                    models. We do not require you to create an account or provide personal information such as your
                    name, email address, or payment details to use our Service.
                </p>

                <h3 class="text-xl font-semibold mt-6 mb-3">1.2 Automatically Collected Information</h3>
                <p class="text-gray-700 mb-4">
                    When you use our Service, we may automatically collect certain information, including:
                </p>
                <ul class="list-disc pl-6 text-gray-700 mb-6 space-y-2">
                    <li>Your IP address</li>
                    <li>Browser type and version</li>
                    <li>Operating system</li>
                    <li>Pages you visit on our website</li>
                    <li>Date and time of your visit</li>
                    <li>Information about your use of our nano banana AI generator</li>
                </ul>

                <h3 class="text-xl font-semibold mt-6 mb-3">1.3 Generated Content</h3>
                <p class="text-gray-700 mb-6">
                    We may collect and store the nano banana figures, models, and other content generated through our
                    Service. This information is used to improve our Service and provide you with better results.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">2. How We Use Your Information</h2>
                <p class="text-gray-700 mb-4">
                    We use the information we collect for the following purposes:
                </p>
                <ul class="list-disc pl-6 text-gray-700 mb-6 space-y-2">
                    <li>To provide and maintain our Service</li>
                    <li>To improve our Service and develop new features</li>
                    <li>To generate nano banana figures and models based on your prompts</li>
                    <li>To analyze how users interact with our Service</li>
                    <li>To prevent fraud and ensure the security of our Service</li>
                </ul>

                <h2 class="text-2xl font-bold mt-10 mb-4">3. How We Share Your Information</h2>
                <p class="text-gray-700 mb-6">
                    We do not share your personal information with third parties, except in the following cases:
                </p>
                <ul class="list-disc pl-6 text-gray-700 mb-6 space-y-2">
                    <li>With your consent</li>
                    <li>To comply with legal obligations</li>
                    <li>To protect and defend our rights and property</li>
                    <li>To prevent or investigate possible wrongdoing in connection with the Service</li>
                    <li>To protect the personal safety of users of the Service or the public</li>
                </ul>

                <p class="text-gray-700 mb-6">
                    We may share aggregated and anonymized information that does not identify you personally with third
                    parties for research, marketing, or other purposes.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">4. Data Retention</h2>
                <p class="text-gray-700 mb-6">
                    We retain your prompts and generated nano banana content for as long as necessary to provide our
                    Service and for legitimate business purposes, such as improving our AI models. We may retain
                    automatically collected information for up to 12 months.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">5. Your Rights</h2>
                <p class="text-gray-700 mb-4">
                    You have the following rights regarding your information:
                </p>
                <ul class="list-disc pl-6 text-gray-700 mb-6 space-y-2">
                    <li>The right to access the information we collect about you</li>
                    <li>The right to request that we correct any inaccurate information</li>
                    <li>The right to request that we delete your information</li>
                    <li>The right to object to our processing of your information</li>
                </ul>
                <p class="text-gray-700 mb-6">
                    To exercise these rights, please contact us at privacy@nanobananas.me.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">6. Security</h2>
                <p class="text-gray-700 mb-6">
                    We take reasonable measures to protect your information from unauthorized access, use, or
                    disclosure. However, no method of transmission over the Internet or electronic storage is completely
                    secure, so we cannot guarantee absolute security.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">7. Cookies</h2>
                <p class="text-gray-700 mb-6">
                    Our website uses cookies to improve your experience. Cookies are small data files stored on your
                    device. You can disable cookies through your browser settings, but this may affect the functionality
                    of our Service.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">8. Changes to This Privacy Policy</h2>
                <p class="text-gray-700 mb-6">
                    We may update this Privacy Policy from time to time. We will notify you of any material changes by
                    posting the new Privacy Policy on this page and updating the "Last updated" date. Your continued use
                    of the Service after such changes constitutes your acceptance of the new Privacy Policy.
                </p>

                <h2 class="text-2xl font-bold mt-10 mb-4">9. Contact Us</h2>
                <p class="text-gray-700 mb-6">
                    If you have any questions about this Privacy Policy, please contact us at:
                </p>
                <p class="text-gray-700 mb-2">
                    <i class="fa fa-envelope mr-2 text-primary"></i> privacy@nanobananas.me
                </p>
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <a href="/" class="flex items-center gap-2 mb-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center">
                            <span class="text-white font-bold text-xl">N</span>
                        </div>
                        <span class="text-2xl font-bold">NanoBananas</span>
                    </a>
                    <p class="text-gray-400 mb-4">
                        Free AI tool for creating amazing nano banana figures, models and artwork with simple prompts.
                    </p>
                    <div class="flex gap-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Twitter">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Instagram">
                            <i class="fa fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Facebook">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Discord">
                            <i class="fa fa-discord"></i>
                        </a>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-bold mb-4">Product</h3>
                    <ul class="space-y-2">
                        <li><a href="/#features" class="text-gray-400 hover:text-white transition-colors">Features</a>
                        </li>
                        <li><a href="/#generator" class="text-gray-400 hover:text-white transition-colors">Generator</a>
                        </li>
                        <li><a href="/#prompts" class="text-gray-400 hover:text-white transition-colors">Prompts</a>
                        </li>
                        <li><a href="/#examples" class="text-gray-400 hover:text-white transition-colors">Examples</a>
                        </li>
                        <li><a href="/#figures" class="text-gray-400 hover:text-white transition-colors">Figures</a>
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-bold mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Blog</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Tutorials</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Community</a></li>
                        <li><a href="/#faq" class="text-gray-400 hover:text-white transition-colors">FAQ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Contact</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-bold mb-4">Legal</h3>
                    <ul class="space-y-2">
                        <li><a href="privacy.html" class="text-gray-400 hover:text-white transition-colors">Privacy
                                Policy</a></li>
                        <li><a href="terms.html" class="text-gray-400 hover:text-white transition-colors">Terms of
                                Service</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Copyright</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Usage Rights</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-800 pt-8 text-center text-gray-500 text-sm">
                <p>&copy; 2025 NanoBananas.me. All rights reserved. Free nano banana AI generator.</p>
            </div>
        </div>
    </footer>

    <script>
        // 移动端菜单切换
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');

        menuToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // 导航栏滚动效果
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.classList.add('shadow-md');
                header.classList.remove('shadow-sm');
            } else {
                header.classList.remove('shadow-md');
                header.classList.add('shadow-sm');
            }
        });

        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();

                // 关闭移动菜单（如果打开）
                if (!mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                }

                const targetId = this.getAttribute('href');
                if (targetId === '#') return;

                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        const loginModal = document.getElementById("login-modal");
        const openSignInBtn = document.getElementById("open-login-modal-btn");
        const closeModalBtn = document.getElementById('close-login-modal-btn');
        const googleLoginBtn = document.getElementById("loginBtn");
        const userInfoContainer = document.getElementById('user-info-container');
        const userAvatarImg = document.getElementById('user-avatar');
        const userNameSpan = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');

        const GOOGLE_CLIENT_ID = "98611438844-610u4rlujgvhb6egkrgjctj7765m3vji.apps.googleusercontent.com";
        const BACKEND_REDIRECT_URI = "https://api.nanobananas.me/prod-api/g/callback";

        // --- UI Update Functions ---

        /**
         * Updates the UI to show the user as logged in.
         * @param {object} user - The user object with name and picture properties.
         */
        function updateUIForLogin(user) {
            openSignInBtn.classList.add('hidden');
            userInfoContainer.classList.remove('hidden');
            userInfoContainer.classList.add('flex');
            console.log(user)
            userAvatarImg.src = user.picture;
            userNameSpan.textContent = user.name;

            const credits = user.score || 0;
            if (dropdownUserCreditsSpan) dropdownUserCreditsSpan.textContent = credits;

            purchaseButtons.forEach((button) => {
                button.textContent = 'Get Started';
            });

            if (dropdownUserName) dropdownUserName.textContent = user.name;
            if (dropdownUserEmail) dropdownUserEmail.textContent = user.email;
            loginModal.classList.add('hidden');
        }

        /**
         * Updates the UI to show the user as logged out.
         */
        function updateUIForLogout() {
            openSignInBtn.classList.remove('hidden');
            userInfoContainer.classList.add('hidden');
            userAvatarImg.src = '';
            userNameSpan.textContent = '';
        }

        // --- Event Listeners ---

        // Open login modal
        openSignInBtn.addEventListener("click", () => {
            loginModal.classList.remove("hidden");
        });

        // Close login modal
        closeModalBtn.addEventListener("click", () => {
            loginModal.classList.add("hidden");
        });

        // Start Google login process
        googleLoginBtn.addEventListener('click', () => {
            loginDialog();
        });

        // Handle logout
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('user_info');
            localStorage.removeItem('auth_token');
            updateUIForLogout();
        });


        // --- Core Login Functions ---

        /**
         * Opens the Google authentication popup window.
         */
        function loginDialog() {
            const googleAuthUrl = 'https://accounts.google.com/o/oauth2/v2/auth';
            const params = {
                client_id: GOOGLE_CLIENT_ID,
                redirect_uri: BACKEND_REDIRECT_URI,
                response_type: 'code',
                scope: 'openid email profile',
                prompt: 'select_account',
                state: '1111'
            };
            const finalAuthUrl = `${googleAuthUrl}?${new URLSearchParams(params)}`;
            const width = 600, height = 600;
            const left = window.screen.width / 2 - width / 2;
            const top = window.screen.height / 2 - height / 2;
            const popup = window.open(finalAuthUrl, 'GoogleLogin', `width=${width},height=${height},left=${left},top=${top}`);

            window.removeEventListener('message', handleAuthMessage);
            window.addEventListener('message', handleAuthMessage);

            const checkPopupClosed = setInterval(() => {
                if (popup && popup.closed) {
                    clearInterval(checkPopupClosed);
                    window.removeEventListener('message', handleAuthMessage);
                }
            }, 500); // Check every half second
        }

        function handleAuthMessage(event) {
            if (event.origin !== "https://api.nanobananas.me") {
                return; // Ignore messages from other sources (like browser extensions)
            }

            if (!event.data || !event.data.token) {
                return; // The message is from our origin but not the one we want.
            }


            loginModal.classList.add('hidden');

            window.removeEventListener('message', handleAuthMessage);

            const { token: nestedJsonString } = event.data;

            try {
                const { user, token: jwtToken } = JSON.parse(nestedJsonString);
                if (!jwtToken || !user) return;

                localStorage.setItem("auth_token", jwtToken);
                localStorage.setItem("user_info", JSON.stringify(user));
                updateUIForLogin(user);
                updateUser()
            } catch (error) {
                console.error("Error parsing auth response:", error);
                updateUser()
            }
        }

        /**
         * Checks for stored user info on page load to maintain login state.
         */
        function checkLoginStatus() {
            const userInfoStr = localStorage.getItem('user_info');
            if (userInfoStr) {
                try {
                    const user = JSON.parse(userInfoStr);
                    if (user && user.name && user.picture) {
                        updateUIForLogin(user);
                    } else {
                        localStorage.removeItem('user_info');
                    }
                } catch (e) {
                    console.error("Failed to parse user info from localStorage", e);
                    localStorage.removeItem('user_info');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', checkLoginStatus);


        const dropdownUserName = document.getElementById('dropdown-user-name');
        const dropdownUserEmail = document.getElementById('dropdown-user-email');
        const userCreditsSpan = document.getElementById('user-credits');

        /**
         * [UPDATED] Updates the UI to show the user as logged in and populates the dropdown.
         * @param {object} user - The user object with name, email, and picture properties.
         */
        function updateUIForLogin(user) {
            // Update header elements
            openSignInBtn.classList.add('hidden');
            userInfoContainer.classList.remove('hidden');
            userAvatarImg.src = user.picture;
            userNameSpan.textContent = user.name; // For display next to avatar

            // **NEW**: Populate the new dropdown menu
            if (dropdownUserName) dropdownUserName.textContent = user.name;
            if (dropdownUserEmail) dropdownUserEmail.textContent = user.email;
            // You'll need to fetch the actual credit count from your API.
            // For now, it will use the static value '2' from the HTML.
            // Example of how you would update it: if (userCreditsSpan) userCreditsSpan.textContent = user.credits;

            loginModal.classList.add('hidden'); // Ensure modal is closed
        }

        /**
         * Updates the UI to show the user as logged out.
         */
        function updateUIForLogout() {
            openSignInBtn.classList.remove('hidden');
            userInfoContainer.classList.add('hidden');
            userAvatarImg.src = '';
            userNameSpan.textContent = '';
            if (dropdownUserName) dropdownUserName.textContent = '';
            if (dropdownUserEmail) dropdownUserEmail.textContent = '';
        }


        const userMenuButton = document.getElementById('user-menu-button');
        const userMenuDropdown = document.getElementById('user-menu-dropdown');

        if (userMenuButton) {
            userMenuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                userMenuDropdown.classList.toggle('hidden');
            });
        }

        window.addEventListener('click', () => {
            if (userMenuDropdown && !userMenuDropdown.classList.contains('hidden')) {
                userMenuDropdown.classList.add('hidden');
            }
        });
        async function updateUser() {
            const response = await fetch('https://api.nanobananas.me/prod-api/g/getUser', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    ...(getToken() && { "Authorization": "Bearer " + getToken() }),
                },

            });
            const data = await response.json();
            if (data.data) {
                updateUIForLogin(data.data);
            }

        }


        updateUser();


    </script>
</body>

</html>