<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Confirmation - NanoBananas</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Keyframes for the background element animations */
        @keyframes rotate {
            from {
                transform: rotate(0deg) scale(1);
            }

            to {
                transform: rotate(360deg) scale(1.05);
            }
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
                opacity: 0;
            }

            25% {
                opacity: 0.7;
            }

            50% {
                transform: translateY(-150px);
            }

            75% {
                opacity: 0.7;
            }

            100% {
                transform: translateY(-300px);
                opacity: 0;
            }
        }

        .animated-blob-1 {
            animation: rotate 45s alternate-reverse infinite linear;
        }

        .animated-blob-2 {
            animation: rotate 60s alternate infinite linear;
        }

        .particle {
            animation: float 20s infinite linear;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 relative min-h-screen overflow-hidden">

    <!-- ====================================================== -->
    <!-- START: Decorative Background with NanoBananas Elements -->
    <!-- ====================================================== -->
    <div aria-hidden="true" class="absolute inset-0 -z-20">
        <!-- Soft, blurred, rotating gradient blobs -->
        <div
            class="absolute top-[-20%] left-[-25%] w-96 h-96 sm:w-[500px] sm:h-[500px] bg-gradient-to-br from-blue-200 to-purple-200 rounded-full filter blur-3xl opacity-30 animated-blob-1">
        </div>
        <div
            class="absolute bottom-[-20%] right-[-25%] w-96 h-96 sm:w-[600px] sm:h-[600px] bg-gradient-to-br from-orange-100 to-red-200 rounded-full filter blur-3xl opacity-20 animated-blob-2">
        </div>

        <!-- Floating Particles -->
        <div class="absolute top-1/4 left-1/4 w-1 h-1 bg-white rounded-full particle" style="animation-delay: -2s;">
        </div>
        <div class="absolute top-1/2 left-3/4 w-2 h-2 bg-white rounded-full particle" style="animation-delay: -5s;">
        </div>
        <div class="absolute top-3/4 left-1/3 w-1.5 h-1.5 bg-white rounded-full particle" style="animation-delay: -8s;">
        </div>
        <div class="absolute bottom-1/4 right-1/2 w-1 h-1 bg-white rounded-full particle"
            style="animation-delay: -12s;"></div>
    </div>

    <!-- NanoBananas Line Art Icons -->
    <div aria-hidden="true" class="absolute inset-0 -z-10 w-full h-full flex items-center justify-center">
        <svg class="absolute w-[800px] h-[800px] opacity-[0.04] text-slate-900"
            style="transform: rotate(-15deg) translateX(-10%) translateY(5%);">
            <defs>
                <g id="line-art-camera">
                    <rect x="0" y="5" width="60" height="40" rx="8" stroke="currentColor" stroke-width="2"
                        fill="none" />
                    <circle cx="30" cy="25" r="12" stroke="currentColor" stroke-width="2" fill="none" />
                    <circle cx="30" cy="25" r="5" stroke="currentColor" stroke-width="1.5" fill="none" />
                    <line x1="48" y1="12" x2="52" y2="12" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </g>
                <g id="line-art-palette">
                    <path d="M45,5 C60,5 70,15 70,30 C70,45 60,55 45,55 C25,55 10,45 10,30 C10,15 25,5 45,5 Z"
                        stroke="currentColor" stroke-width="2" fill="none" />
                    <circle cx="25" cy="20" r="4" fill="currentColor" opacity="0.5" />
                    <circle cx="55" cy="22" r="3" fill="currentColor" opacity="0.5" />
                    <circle cx="50" cy="40" r="3.5" fill="currentColor" opacity="0.5" />
                    <circle cx="22" cy="35" r="6" stroke="currentColor" stroke-width="2" fill="none" />
                </g>
            </defs>
            <use href="#line-art-camera" x="100" y="600" transform="scale(1.5)" />
            <use href="#line-art-palette" x="550" y="150" transform="scale(1.8)" />
        </svg>
    </div>
    <!-- ====================================================== -->
    <!-- END: Decorative Background -->
    <!-- ====================================================== -->


    <!-- Header (Consistent with your pricing page) -->
    <header class="sticky top-0 left-0 right-0 bg-white/80 backdrop-blur-md z-50 shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20">
                <a href="/" class="flex items-center gap-2">
                    <div
                        class="w-10 h-10 rounded-lg bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center">
                        <span class="text-white font-bold text-xl">N</span>
                    </div>
                    <span class="text-xl md:text-2xl font-bold"
                        style="background-image: linear-gradient(to right, #f97316, #ef4444); -webkit-background-clip: text; background-clip: text; color: transparent;">
                        NanoBananas
                    </span>
                </a>
            </div>
        </div>
    </header>
    <main class="min-h-[calc(100vh-80px)] w-full flex items-center justify-center p-4 z-10">
        <div
            class="w-full max-w-md bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl border border-white/60 p-8 sm:p-10 text-center transition-all duration-500">

            <!-- State 1: Loading / Confirmation Pending -->
            <div id="loading-state">
                <div class="w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-spinner fa-spin text-slate-500 text-3xl"></i>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Confirming Your Payment...</h1>
                <p class="text-slate-500 mb-8">Please wait, this page will update automatically.</p>
                <button id="manual-check-btn"
                    class="w-full bg-white text-slate-700 font-semibold py-3 px-6 rounded-lg border border-slate-300 transition-all duration-300 hover:bg-slate-50 hover:border-slate-400 disabled:opacity-70 disabled:cursor-wait">
                    <i class="fas fa-redo mr-2"></i> I Have Completed Payment
                </button>
            </div>

            <!-- State 2: Payment Success -->
            <div id="success-state" class="hidden">
                <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-check text-green-500 text-3xl"></i>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Payment Successful!</h1>
                <p class="text-slate-500 mb-8">Thank you! Your account is ready. Start your creative journey now.</p>
                <a href="/"
                    class="w-full inline-block bg-gradient-to-r from-red-500 to-orange-500 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-transform duration-300 hover:scale-105">
                    Start Creating <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>

            <!-- State 3: Payment Failed -->
            <div id="failure-state" class="hidden">
                <div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-times text-red-500 text-3xl"></i>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Payment Failed</h1>
                <p class="text-slate-500 mb-8">Sorry, the payment could not be completed. Please try again.</p>
                <a href="/pricing.html"
                    class="w-full inline-block bg-white text-slate-700 font-semibold py-3 px-6 rounded-lg border border-slate-300 transition-all duration-300 hover:bg-slate-50 hover:border-slate-400">
                    Return to Pricing to Retry
                </a>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadingState = document.getElementById('loading-state');
            const successState = document.getElementById('success-state');
            const failureState = document.getElementById('failure-state');
            const manualCheckBtn = document.getElementById('manual-check-btn');

            let pollingInterval;
            let checkAttempts = 0;
            const MAX_ATTEMPTS = 15;
            let params;
            const showState = (state) => {
                loadingState.classList.add('hidden');
                successState.classList.add('hidden');
                failureState.classList.add('hidden');
                if (state === 'success') successState.classList.remove('hidden');
                else if (state === 'failure') failureState.classList.remove('hidden');
                else loadingState.classList.remove('hidden');
            };

            const checkPaymentStatus = async () => {
                if(window.location.search){
                     params =window.location.search;
                }
                try {
               
                  const response = await fetch(`https://api.nanobananas.me/prod-api/creem/callback?${params}`);
                  const data = await response.json();
                  if(data.code ==0){
                    return 'SUCCESS';
                  }else{
                    return 'ERROR';
                  }
                } catch (error) {
                  console.error("Failed to check payment status:", error);
                  return 'PENDING'; // Continue polling on network error
                }
            };

            const pollForStatus = async () => {
                if (checkAttempts >= MAX_ATTEMPTS) {
                    console.log("Max attempts reached. Stopping poll.");
                    clearInterval(pollingInterval);
                    showState('failure');
                    return;
                }

                const status = await checkPaymentStatus();
                if (status === 'SUCCESS') {
                    console.log("Payment successful!");
                    clearInterval(pollingInterval);
                    showState('success');
                    window.location.href = '/';
                } else if (status === 'FAILED') {
                    console.log("Payment failed.");
                    clearInterval(pollingInterval);
                    showState('failure');
                }
            };

            manualCheckBtn.addEventListener('click', () => {
                manualCheckBtn.disabled = true;
                manualCheckBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Checking...';

                pollForStatus().finally(() => {
                    if (loadingState.classList.contains('hidden') === false) {
                        manualCheckBtn.disabled = false;
                        manualCheckBtn.innerHTML = '<i class="fas fa-redo mr-2"></i> I Have Completed Payment';
                    }
                });
            });

            // Start polling when the page loads
            showState('loading');
            // pollingInterval = setInterval(pollForStatus, 2000); // Poll every 2 seconds
            pollForStatus();
        });
    </script>
</body>

</html>